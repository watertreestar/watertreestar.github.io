<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="Xingyao" />
  <meta name="description" content="A simple blog, code repository, coding record" />
  
  
  <title>
    
      redisé…ç½®æ–‡ä»¶ 
      
      
      |
    
     ğŸ¤£å¹¸é¥åŒå­¦
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

  <link rel="stylesheet" href="https://fonts.loli.net/css?family=Fira code&display=swap" rel="stylesheet"/>

<meta name="generator" content="Hexo 4.1.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Oranges</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">redisé…ç½®æ–‡ä»¶</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
          2018-09-02 12:04:41
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                
                <span class="span--tag">
                  <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8Credis/" title="æ•°æ®åº“ï¼Œredis">
                    <b>#</b> æ•°æ®åº“ï¼Œredis
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p>æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨redisæœåŠ¡å™¨çš„æ—¶å€™æŒ‡å®šé…ç½®æ–‡ä»¶</p>
<p>redisé…ç½®æ–‡ä»¶<code>redis.con</code>åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œå…ˆæ˜ç¡®äº†ä¸€äº›å•ä½</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br></pre></td></tr></table></figure>
<p>redisæ”¯æŒä»å¤–éƒ¨æ–‡ä»¶ä¸­å¼•å…¥é…ç½®æ–‡ä»¶</p>
<a id="more"></a>
<p><code>include /path/to/other.conf</code></p>
<p>redisçš„é…ç½®æ–‡ä»¶ä¸­åˆ†æˆäº†å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>é€šç”¨(general)</li>
<li>å¿«ç…§(snapshotting)</li>
<li>å¤åˆ¶(replicaion)</li>
<li>å®‰å…¨(security)</li>
<li>é™åˆ¶(limits)</li>
<li>è¿½åŠ æ¨¡å¼(AOF)</li>
<li>LUAè„šæœ¬(LUA script)</li>
<li>æ…¢æ—¥å¿—(slow log)</li>
<li>äº‹ä»¶é€šçŸ¥(event notification)</li>
</ul>
<h1 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œrediså¹¶ä¸æ˜¯ä»¥daemonå½¢å¼æ¥è¿è¡Œçš„ã€‚é€šè¿‡daemonizeé…ç½®é¡¹å¯ä»¥æ§åˆ¶redisçš„è¿è¡Œå½¢å¼ï¼Œå¦‚æœæ”¹ä¸ºyesï¼Œé‚£ä¹ˆrediså°±ä¼šä»¥daemonå½¢å¼è¿è¡Œï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">daemonize</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œredisä¼šå“åº”æœ¬æœºæ‰€æœ‰å¯ç”¨ç½‘å¡çš„è¿æ¥è¯·æ±‚ã€‚å½“ç„¶ï¼Œrediså…è®¸ä½ é€šè¿‡bindé…ç½®é¡¹æ¥æŒ‡å®šè¦ç»‘å®šçš„IP</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">10.8</span><span class="number">.4</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<p>redisçš„é»˜è®¤æœåŠ¡ç«¯å£æ˜¯6379ï¼Œä½ å¯ä»¥é€šè¿‡porté…ç½®é¡¹æ¥ä¿®æ”¹ã€‚å¦‚æœç«¯å£è®¾ç½®ä¸º0çš„è¯ï¼Œredisä¾¿ä¸ä¼šç›‘å¬ç«¯å£äº†ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">6379</span></span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ªredis-clientä¸€ç›´æ²¡æœ‰è¯·æ±‚å‘å‘serverç«¯ï¼Œé‚£ä¹ˆserverç«¯æœ‰æƒä¸»åŠ¨å…³é—­è¿™ä¸ªè¿æ¥ï¼Œå¯ä»¥é€šè¿‡timeoutæ¥è®¾ç½®â€œç©ºé—²è¶…æ—¶æ—¶é™â€ï¼Œ0è¡¨ç¤ºæ°¸ä¸å…³é—­</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>TCPè¿æ¥ä¿æ´»ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡tcp-keepaliveé…ç½®é¡¹æ¥è¿›è¡Œè®¾ç½®ï¼Œå•ä½ä¸ºç§’ï¼Œå‡å¦‚è®¾ç½®ä¸º60ç§’ï¼Œåˆ™serverç«¯ä¼šæ¯60ç§’å‘è¿æ¥ç©ºé—²çš„å®¢æˆ·ç«¯å‘èµ·ä¸€æ¬¡ACKè¯·æ±‚ï¼Œä»¥æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦å·²ç»æŒ‚æ‰ï¼Œå¯¹äºæ— å“åº”çš„å®¢æˆ·ç«¯åˆ™ä¼šå…³é—­å…¶è¿æ¥ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œä¿æ´»æ£€æµ‹ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-keepalive <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>redisæ”¯æŒé€šè¿‡loglevelé…ç½®é¡¹è®¾ç½®æ—¥å¿—ç­‰çº§ï¼Œå…±åˆ†å››çº§ï¼Œå³debugã€verboseã€noticeã€warningã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">loglevel</span> <span class="literal">notice</span></span><br></pre></td></tr></table></figure>
<p>redisä¹Ÿæ”¯æŒé€šè¿‡logfileé…ç½®é¡¹æ¥è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„ç”Ÿæˆä½ç½®ã€‚å¦‚æœè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™redisä¼šå°†æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å‡å¦‚ä½ åœ¨daemonæƒ…å†µä¸‹å°†æ—¥å¿—è®¾ç½®ä¸ºè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—ä¼šè¢«å†™åˆ°/dev/nullä¸­ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">logfile</span> <span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºredisæ¥è¯´ï¼Œå¯ä»¥è®¾ç½®å…¶æ•°æ®åº“çš„æ€»æ•°é‡ï¼Œå‡å¦‚ä½ å¸Œæœ›ä¸€ä¸ªredisåŒ…å«16ä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆè®¾ç½®å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>è¿™16ä¸ªæ•°æ®åº“çš„ç¼–å·å°†æ˜¯0åˆ°15ã€‚é»˜è®¤çš„æ•°æ®åº“æ˜¯ç¼–å·ä¸º0çš„æ•°æ®åº“ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨select <DBid>æ¥é€‰æ‹©ç›¸åº”çš„æ•°æ®åº“ã€‚</DBid></p>
</blockquote>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases <span class="number">16</span></span><br></pre></td></tr></table></figure>
<h1 id="å¿«ç…§"><a href="#å¿«ç…§" class="headerlink" title="å¿«ç…§"></a>å¿«ç…§</h1><p>å¿«ç…§ï¼Œä¸»è¦æ¶‰åŠçš„æ˜¯redisçš„RDBæŒä¹…åŒ–ç›¸å…³çš„é…ç½®</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹çš„æŒ‡ä»¤æ¥è®©æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå³æ§åˆ¶RDBå¿«ç…§åŠŸèƒ½ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save <span class="number">60</span> <span class="number">500</span>      </span><br><span class="line">#  <span class="number">60</span> ç§’å†…è‡³å°‘æœ‰<span class="number">500</span>ä¸ª<span class="type">key</span>å‘ç”Ÿæ”¹å˜ï¼Œå°±è§¦å‘ä¸€æ¬¡å¿«ç…§æŒä¹…åŒ–</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æƒ³ç¦ç”¨RDBæŒä¹…åŒ–çš„ç­–ç•¥ï¼Œåªè¦ä¸è®¾ç½®ä»»ä½•saveæŒ‡ä»¤å°±å¯ä»¥ï¼Œæˆ–è€…ç»™saveä¼ å…¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å‚æ•°ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒæ•ˆæœï¼Œ</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">save</span> <span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”¨æˆ·å¼€å¯äº†RDBå¿«ç…§åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨redisæŒä¹…åŒ–æ•°æ®åˆ°ç£ç›˜æ—¶å¦‚æœå‡ºç°å¤±è´¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œredisä¼šåœæ­¢æ¥å—æ‰€æœ‰çš„å†™è¯·æ±‚ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºå¯ä»¥è®©ç”¨æˆ·å¾ˆæ˜ç¡®çš„çŸ¥é“å†…å­˜ä¸­çš„æ•°æ®å’Œç£ç›˜ä¸Šçš„æ•°æ®å·²ç»å­˜åœ¨ä¸ä¸€è‡´äº†ã€‚å¦‚æœredisä¸é¡¾è¿™ç§ä¸ä¸€è‡´ï¼Œä¸€æ„å­¤è¡Œçš„ç»§ç»­æ¥æ”¶å†™è¯·æ±‚ï¼Œå°±å¯èƒ½ä¼šå¼•èµ·ä¸€äº›ç¾éš¾æ€§çš„åæœã€‚</p>
<p>å¦‚æœä¸‹ä¸€æ¬¡RDBæŒä¹…åŒ–æˆåŠŸï¼Œredisä¼šè‡ªåŠ¨æ¢å¤æ¥å—å†™è¯·æ±‚ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä½ ä¸åœ¨ä¹è¿™ç§æ•°æ®ä¸ä¸€è‡´æˆ–è€…æœ‰å…¶ä»–çš„æ‰‹æ®µå‘ç°å’Œæ§åˆ¶è¿™ç§ä¸ä¸€è‡´çš„è¯ï¼Œä½ å®Œå…¨å¯ä»¥å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å¿«ç…§å†™å…¥å¤±è´¥æ—¶ï¼Œä¹Ÿèƒ½ç¡®ä¿redisç»§ç»­æ¥å—æ–°çš„å†™è¯·æ±‚ã€‚é…ç½®é¡¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop-writes-<span class="keyword">on</span>-bgsave-<span class="keyword">error</span> yes</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å¿«ç…§ä¼šæ¯”è¾ƒå¤§ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rdbcompression</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®å¿«ç…§æ–‡ä»¶çš„åç§°ï¼Œé»˜è®¤æ˜¯è¿™æ ·é…ç½®çš„ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dbfilename</span> <span class="selector-tag">dump</span><span class="selector-class">.rdb</span></span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œä½ è¿˜å¯ä»¥è®¾ç½®è¿™ä¸ªå¿«ç…§æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ã€‚æ¯”å¦‚é»˜è®¤è®¾ç½®å°±æ˜¯å½“å‰æ–‡ä»¶å¤¹ï¼š</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> ./</span><br></pre></td></tr></table></figure>
<h1 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h1><p>redisæä¾›äº†ä¸»ä»åŒæ­¥åŠŸèƒ½ã€‚</p>
<p>é€šè¿‡slaveofé…ç½®é¡¹å¯ä»¥æ§åˆ¶æŸä¸€ä¸ªredisä½œä¸ºå¦ä¸€ä¸ªredisçš„ä»æœåŠ¡å™¨ï¼Œé€šè¿‡æŒ‡å®šIPå’Œç«¯å£æ¥å®šä½åˆ°ä¸»redisçš„ä½ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof <span class="tag">&lt;<span class="name">masterip</span>&gt;</span> <span class="tag">&lt;<span class="name">masterport</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸»redisè®¾ç½®äº†éªŒè¯å¯†ç çš„è¯ï¼ˆä½¿ç”¨requirepassæ¥è®¾ç½®ï¼‰ï¼Œåˆ™åœ¨ä»redisçš„é…ç½®ä¸­è¦ä½¿ç”¨masterauthæ¥è®¾ç½®æ ¡éªŒå¯†ç ï¼Œå¦åˆ™çš„è¯ï¼Œä¸»redisä¼šæ‹’ç»ä»redisçš„è®¿é—®è¯·æ±‚ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth <span class="tag">&lt;<span class="name">master-password</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“ä»rediså¤±å»äº†ä¸ä¸»redisçš„è¿æ¥ï¼Œæˆ–è€…ä¸»ä»åŒæ­¥æ­£åœ¨è¿›è¡Œä¸­æ—¶ï¼Œredisè¯¥å¦‚ä½•å¤„ç†å¤–éƒ¨å‘æ¥çš„è®¿é—®è¯·æ±‚å‘¢ï¼Ÿè¿™é‡Œï¼Œä»rediså¯ä»¥æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<p>ç¬¬ä¸€ç§é€‰æ‹©ï¼šå¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºyesï¼ˆé»˜è®¤ï¼‰ï¼Œåˆ™ä»redisä»ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚</p>
<p>ç¬¬äºŒç§é€‰æ‹©ï¼šå¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºnoï¼Œåˆ™ä»redisä¼šå¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿”å›â€œSYNC with master in progressâ€ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå½“å®¢æˆ·ç«¯å‘æ¥INFOè¯·æ±‚å’ŒSLAVEOFè¯·æ±‚ï¼Œä»redisè¿˜æ˜¯ä¼šè¿›è¡Œå¤„ç†ã€‚</p>
<p>ä½ å¯ä»¥æ§åˆ¶ä¸€ä¸ªä»redisæ˜¯å¦å¯ä»¥æ¥å—å†™è¯·æ±‚ã€‚å°†æ•°æ®ç›´æ¥å†™å…¥ä»redisï¼Œä¸€èˆ¬åªé€‚ç”¨äºé‚£äº›ç”Ÿå‘½å‘¨æœŸéå¸¸çŸ­çš„æ•°æ®ï¼Œå› ä¸ºåœ¨ä¸»ä»åŒæ­¥æ—¶ï¼Œè¿™äº›ä¸´æ—¶æ•°æ®å°±ä¼šè¢«æ¸…ç†æ‰ã€‚è‡ªä»redis2.6ç‰ˆæœ¬ä¹‹åï¼Œé»˜è®¤ä»redisä¸ºåªè¯»ã€‚</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">slave</span>-<span class="keyword">read</span>-only yes</span><br></pre></td></tr></table></figure>
<p>åªè¯»çš„ä»rediså¹¶ä¸é€‚åˆç›´æ¥æš´éœ²ç»™ä¸å¯ä¿¡çš„å®¢æˆ·ç«¯ã€‚ä¸ºäº†å°½é‡é™ä½é£é™©ï¼Œå¯ä»¥ä½¿ç”¨rename-commandæŒ‡ä»¤æ¥å°†ä¸€äº›å¯èƒ½æœ‰ç ´ååŠ›çš„å‘½ä»¤é‡å‘½åï¼Œé¿å…å¤–éƒ¨ç›´æ¥è°ƒç”¨ã€‚æ¯”å¦‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename-command<span class="built_in"> CONFIG </span>b840fc02d524045429941cc15f59e41cb7be6c52</span><br></pre></td></tr></table></figure>
<p>ä»redisä¼šå‘¨æœŸæ€§çš„å‘ä¸»rediså‘å‡ºPINGåŒ…ã€‚ä½ å¯ä»¥é€šè¿‡repl_ping_slave_periodæŒ‡ä»¤æ¥æ§åˆ¶å…¶å‘¨æœŸã€‚é»˜è®¤æ˜¯10ç§’ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-ping-slave-period <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸»ä»åŒæ­¥æ—¶ï¼Œå¯èƒ½åœ¨è¿™äº›æƒ…å†µä¸‹ä¼šæœ‰è¶…æ—¶å‘ç”Ÿï¼š</p>
<p>1.ä»¥ä»redisçš„è§’åº¦æ¥çœ‹ï¼Œå½“æœ‰å¤§è§„æ¨¡IOä¼ è¾“æ—¶ã€‚<br>2.ä»¥ä»redisçš„è§’åº¦æ¥çœ‹ï¼Œå½“æ•°æ®ä¼ è¾“æˆ–PINGæ—¶ï¼Œä¸»redisè¶…æ—¶<br>3.ä»¥ä¸»redisçš„è§’åº¦æ¥çœ‹ï¼Œåœ¨å›å¤ä»redisçš„PINGæ—¶ï¼Œä»redisè¶…æ—¶</p>
<p>ç”¨æˆ·å¯ä»¥è®¾ç½®ä¸Šè¿°è¶…æ—¶çš„æ—¶é™ï¼Œä¸è¿‡è¦ç¡®ä¿è¿™ä¸ªæ—¶é™æ¯”repl-ping-slave-periodçš„å€¼è¦å¤§ï¼Œå¦åˆ™æ¯æ¬¡ä¸»rediséƒ½ä¼šè®¤ä¸ºä»redisè¶…æ—¶ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-timeout <span class="number">60</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨ä¸»ä»åŒæ­¥æ—¶æ˜¯å¦ç¦ç”¨TCP_NODELAYã€‚å¦‚æœå¼€å¯TCP_NODELAYï¼Œé‚£ä¹ˆä¸»redisä¼šä½¿ç”¨æ›´å°‘çš„TCPåŒ…å’Œæ›´å°‘çš„å¸¦å®½æ¥å‘ä»redisä¼ è¾“æ•°æ®ã€‚ä½†æ˜¯è¿™å¯èƒ½ä¼šå¢åŠ ä¸€äº›åŒæ­¥çš„å»¶è¿Ÿï¼Œå¤§æ¦‚ä¼šè¾¾åˆ°40æ¯«ç§’å·¦å³ã€‚å¦‚æœä½ å…³é—­äº†TCP_NODELAYï¼Œé‚£ä¹ˆæ•°æ®åŒæ­¥çš„å»¶è¿Ÿæ—¶é—´ä¼šé™ä½ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å¸¦å®½ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-<span class="keyword">disable</span>-tcp-nodelay <span class="keyword">no</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®åŒæ­¥é˜Ÿåˆ—é•¿åº¦ã€‚é˜Ÿåˆ—é•¿åº¦ï¼ˆbacklog)æ˜¯ä¸»redisä¸­çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œåœ¨ä¸ä»redisæ–­å¼€è¿æ¥æœŸé—´ï¼Œä¸»redisä¼šç”¨è¿™ä¸ªç¼“å†²åŒºæ¥ç¼“å­˜åº”è¯¥å‘ç»™ä»redisçš„æ•°æ®ã€‚è¿™æ ·çš„è¯ï¼Œå½“ä»redisé‡æ–°è¿æ¥ä¸Šä¹‹åï¼Œå°±ä¸å¿…é‡æ–°å…¨é‡åŒæ­¥æ•°æ®ï¼Œåªéœ€è¦åŒæ­¥è¿™éƒ¨åˆ†å¢é‡æ•°æ®å³å¯ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-size <span class="number">1</span>mb</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸»redisç­‰äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œè¿˜æ˜¯æ— æ³•è¿æ¥åˆ°ä»redisï¼Œé‚£ä¹ˆç¼“å†²é˜Ÿåˆ—ä¸­çš„æ•°æ®å°†è¢«æ¸…ç†æ‰ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸»redisè¦ç­‰å¾…çš„æ—¶é—´é•¿åº¦ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºæ°¸è¿œä¸æ¸…ç†ã€‚é»˜è®¤æ˜¯1ä¸ªå°æ—¶ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-ttl <span class="number">3600</span></span><br></pre></td></tr></table></figure>
<h1 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h1><p>æˆ‘ä»¬å¯ä»¥è¦æ±‚rediså®¢æˆ·ç«¯åœ¨å‘redis-serverå‘é€è¯·æ±‚ä¹‹å‰ï¼Œå…ˆè¿›è¡Œå¯†ç éªŒè¯ã€‚å½“ä½ çš„redis-serverå¤„äºä¸€ä¸ªä¸å¤ªå¯ä¿¡çš„ç½‘ç»œç¯å¢ƒä¸­æ—¶ï¼Œç›¸ä¿¡ä½ ä¼šç”¨ä¸Šè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">requirepass ranger</span></span><br></pre></td></tr></table></figure>
<p>rediså…è®¸æˆ‘ä»¬å¯¹redisæŒ‡ä»¤è¿›è¡Œæ›´åï¼Œæ¯”å¦‚å°†ä¸€äº›æ¯”è¾ƒå±é™©çš„å‘½ä»¤æ”¹ä¸ªåå­—ï¼Œé¿å…è¢«è¯¯æ‰§è¡Œã€‚æ¯”å¦‚å¯ä»¥æŠŠCONFIGå‘½ä»¤æ”¹æˆä¸€ä¸ªå¾ˆå¤æ‚çš„åå­—ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤–éƒ¨çš„è°ƒç”¨ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ»¡è¶³å†…éƒ¨è°ƒç”¨çš„éœ€è¦</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename-command<span class="built_in"> CONFIG </span>b840fc02d524045429941cc15f59e41cb7be6c89</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ç¦ç”¨æ‰CONFIGå‘½ä»¤ï¼Œé‚£å°±æ˜¯æŠŠCONFIGçš„åå­—æ”¹æˆä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename-command<span class="built_in"> CONFIG </span><span class="string">""</span></span><br></pre></td></tr></table></figure>
<h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclients <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥è®¾ç½®rediså¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œrediså°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policyæ¥æŒ‡å®šã€‚</p>
<p>å¦‚æœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…æˆ‘ä»¬è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory <span class="tag">&lt;<span class="name">bytes</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºå†…å­˜ç§»é™¤è§„åˆ™æ¥è¯´ï¼Œredisæä¾›äº†å¤šè¾¾6ç§çš„ç§»é™¤è§„åˆ™</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-<span class="keyword">policy</span> <span class="keyword">volatile</span>-lru</span><br></pre></td></tr></table></figure>
<p>LRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ã€‚æ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ã€‚å‡å¦‚redisé»˜è®¤ä¼šæ£€æŸ¥ä¸‰ä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ªï¼Œé‚£ä¹ˆä½ å¯ä»¥æ”¹å˜è¿™ä¸ªkeyæ ·æœ¬çš„æ•°é‡ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-samples <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h1 id="è¿½åŠ æ¨¡å¼"><a href="#è¿½åŠ æ¨¡å¼" class="headerlink" title="è¿½åŠ æ¨¡å¼"></a>è¿½åŠ æ¨¡å¼</h1><p>æˆ‘ä»¬å»ºè®®å¤§å®¶ï¼ŒAOFæœºåˆ¶å’ŒRDBæœºåˆ¶å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä¸ä¼šæœ‰ä»»ä½•å†²çª</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">appendonly</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®aofæ–‡ä»¶çš„åç§°ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">appendfilename</span> <span class="string">"appendonly.aof"</span></span><br></pre></td></tr></table></figure>
<p>fsync()è°ƒç”¨ï¼Œç”¨æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿç«‹å³å°†ç¼“å­˜çš„æŒ‡ä»¤å†™å…¥ç£ç›˜ã€‚ä¸€äº›æ“ä½œç³»ç»Ÿä¼šâ€œç«‹å³â€è¿›è¡Œï¼Œè€Œå¦å¤–ä¸€äº›æ“ä½œç³»ç»Ÿåˆ™ä¼šâ€œå°½å¿«â€è¿›è¡Œã€‚</p>
<p>redisæ”¯æŒä¸‰ç§ä¸åŒçš„æ¨¡å¼ï¼š</p>
<p>1.noï¼šä¸è°ƒç”¨fsync()ã€‚è€Œæ˜¯è®©æ“ä½œç³»ç»Ÿè‡ªè¡Œå†³å®šsyncçš„æ—¶é—´ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œredisçš„æ€§èƒ½ä¼šæœ€å¿«ã€‚<br>2.alwaysï¼šåœ¨æ¯æ¬¡å†™è¯·æ±‚åéƒ½è°ƒç”¨fsync()ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œredisä¼šç›¸å¯¹è¾ƒæ…¢ï¼Œä½†æ•°æ®æœ€å®‰å…¨ã€‚<br>3.everysecï¼šæ¯ç§’é’Ÿè°ƒç”¨ä¸€æ¬¡fsync()ã€‚è¿™æ˜¯æ€§èƒ½å’Œå®‰å…¨çš„æŠ˜è¡·ã€‚</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">appendfsync everysec</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…è®¸redisè‡ªåŠ¨é‡å†™aofã€‚å½“aofå¢é•¿åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œredisä¼šéšå¼è°ƒç”¨BGREWRITEAOFæ¥é‡å†™logæ–‡ä»¶ï¼Œä»¥ç¼©å‡æ–‡ä»¶ä½“ç§¯ã€‚</p>
<p>redisæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šredisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„aofå¤§å°ã€‚å‡å¦‚redisè‡ªå¯åŠ¨è‡³ä»Šè¿˜æ²¡æœ‰è¿›è¡Œè¿‡é‡å†™ï¼Œé‚£ä¹ˆå¯åŠ¨æ—¶aofæ–‡ä»¶çš„å¤§å°ä¼šè¢«ä½œä¸ºåŸºå‡†å€¼ã€‚è¿™ä¸ªåŸºå‡†å€¼ä¼šå’Œå½“å‰çš„aofå¤§å°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå½“å‰aofå¤§å°è¶…å‡ºæ‰€è®¾ç½®çš„å¢é•¿æ¯”ä¾‹ï¼Œåˆ™ä¼šè§¦å‘é‡å†™ã€‚å¦å¤–ï¼Œä½ è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ªæœ€å°å¤§å°ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åœ¨aofå¾ˆå°æ—¶å°±è§¦å‘é‡å†™ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">auto</span>-aof-rewrite-percentage <span class="number">100</span></span><br><span class="line"><span class="built_in">auto</span>-aof-rewrite-min-size <span class="number">64</span>mb</span><br></pre></td></tr></table></figure>
<h1 id="luaè„šæœ¬"><a href="#luaè„šæœ¬" class="headerlink" title="luaè„šæœ¬"></a>luaè„šæœ¬</h1><p>luaè„šæœ¬çš„æœ€å¤§è¿è¡Œæ—¶é—´æ˜¯éœ€è¦è¢«ä¸¥æ ¼é™åˆ¶çš„ï¼Œè¦æ³¨æ„å•ä½æ˜¯æ¯«ç§’ï¼š</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua-<span class="built_in">time</span>-<span class="built_in">limit</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>
<h1 id="æ…¢æ—¥å¿—"><a href="#æ…¢æ—¥å¿—" class="headerlink" title="æ…¢æ—¥å¿—"></a>æ…¢æ—¥å¿—</h1><p>redisæ…¢æ—¥å¿—æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œæ—¥å¿—æŸ¥è¯¢è¶…è¿‡äº†æŒ‡å®šçš„æ—¶é•¿ã€‚è¿™ä¸ªæ—¶é•¿ä¸åŒ…æ‹¬IOæ“ä½œï¼Œæ¯”å¦‚ä¸å®¢æˆ·ç«¯çš„äº¤äº’ã€å‘é€å“åº”å†…å®¹ç­‰ï¼Œè€Œä»…åŒ…æ‹¬å®é™…æ‰§è¡ŒæŸ¥è¯¢å‘½ä»¤çš„æ—¶é—´ã€‚</p>
<p>é’ˆå¯¹æ…¢æ—¥å¿—ï¼Œä½ å¯ä»¥è®¾ç½®ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œæ—¶é•¿ï¼Œå•ä½æ˜¯å¾®ç§’ï¼Œå¦ä¸€ä¸ªæ˜¯æ…¢æ—¥å¿—çš„é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«å†™å…¥æ—¥å¿—æ—¶ï¼Œæœ€è€çš„ä¸€æ¡ä¼šä»å‘½ä»¤æ—¥å¿—é˜Ÿåˆ—ä¸­è¢«ç§»é™¤ã€‚</p>
<p>å•ä½æ˜¯å¾®ç§’ï¼Œå³1000000è¡¨ç¤ºä¸€ç§’ã€‚è´Ÿæ•°åˆ™ä¼šç¦ç”¨æ…¢æ—¥å¿—åŠŸèƒ½ï¼Œè€Œ0åˆ™è¡¨ç¤ºå¼ºåˆ¶è®°å½•æ¯ä¸€ä¸ªå‘½ä»¤ã€‚</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowlog-<span class="built_in">log</span>-slower-than <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<p>æ…¢æ—¥å¿—æœ€å¤§é•¿åº¦ï¼Œå¯ä»¥éšä¾¿å¡«å†™æ•°å€¼ï¼Œæ²¡æœ‰ä¸Šé™ï¼Œä½†è¦æ³¨æ„å®ƒä¼šæ¶ˆè€—å†…å­˜ã€‚ä½ å¯ä»¥ä½¿ç”¨SLOWLOG RESETæ¥é‡è®¾è¿™ä¸ªå€¼ã€‚</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowlog-<span class="built_in">max</span>-<span class="built_in">len</span> <span class="number">128</span></span><br></pre></td></tr></table></figure>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2018/08/20/ckybpqxgl000sd2nhd0a1bjds/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>ä¸Šä¸€é¡µ</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
              2018-09-02 12:04:41
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8Credis/" title="æ•°æ®åº“ï¼Œredis">
                        <b>#</b> æ•°æ®åº“ï¼Œredis
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2018/09/04/ckybpqxgm000td2nh1k8b90kd/" target="_self">
                <span>ä¸‹ä¸€é¡µ</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">ç›®å½•</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#é€šç”¨"><span class="toc-text">é€šç”¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å¿«ç…§"><span class="toc-text">å¿«ç…§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å¤åˆ¶"><span class="toc-text">å¤åˆ¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å®‰å…¨"><span class="toc-text">å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#é™åˆ¶"><span class="toc-text">é™åˆ¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#è¿½åŠ æ¨¡å¼"><span class="toc-text">è¿½åŠ æ¨¡å¼</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#luaè„šæœ¬"><span class="toc-text">luaè„šæœ¬</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ…¢æ—¥å¿—"><span class="toc-text">æ…¢æ—¥å¿—</span></a></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        





      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" href="https://github.com/zchengsite/oranges" target="_blank" rel="noopener">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="facebook" href="">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" href="">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="wechat" href="">
            <i class="iconfont icon-wechat"></i>
          </a>
        </li>
      
        <li>
          <a title="weibo" href="">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a href="https://github.com/watertreestar" target="_blank" rel="noopener">Copyright Â© watertreestar 2021</a>
        
    </div>
  
    <div class="footer-more">
      
        <a href="https://github.com/zchengsite/oranges" target="_blank" rel="noopener">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6 + '&url=' + https%3A%2F%2Fwatertreestar.github.io%2F2018%2F09%2F02%2Fckybpqxgr0010d2nhhc150lfl%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://watertreestar.github.io/2018/09/02/ckybpqxgr0010d2nhhc150lfl/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
    
<script src="/js/shares.js"></script>

  


      </div>
    </div>
  </body>
</html>
